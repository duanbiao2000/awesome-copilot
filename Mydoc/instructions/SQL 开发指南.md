# SQL 开发指南

## 数据库模式生成规范

### 命名约定
- 所有表名使用单数形式
- 所有列名使用单数形式
- 每个表必须包含名为 `id` 的主键列
- 每个表必须包含 `created_at` 列存储创建时间戳
- 每个表必须包含 `updated_at` 列存储最后更新时间戳

### 约束设计
- 每个表必须有主键约束
- 所有外键约束必须命名
- 外键约束应内联定义
- 外键约束应包含 `ON DELETE CASCADE` 选项
- 外键约束应包含 `ON UPDATE CASCADE` 选项
- 外键约束应引用父表的主键

## SQL 编码风格

### 语法规范
- SQL 关键字使用大写（SELECT, FROM, WHERE）
- 嵌套查询和条件使用一致缩进
- 为复杂逻辑添加注释
- 长查询分行以提高可读性
- 按一致顺序组织子句（SELECT, FROM, JOIN, WHERE, GROUP BY, HAVING, ORDER BY）

### 查询结构
- SELECT 语句中使用显式列名而非 SELECT *
- 多表查询时使用表名或别名限定列名
- 优先使用连接而非子查询
- 使用 LIMIT/TOP 限制结果集大小
- 为频繁查询的列创建适当索引
- 避免在 WHERE 子句的索引列上使用函数

## 存储过程规范

### 命名约定
- 存储过程名前缀使用 'usp_'
- 存储过程名使用 PascalCase
- 使用描述性名称表明用途（如 `usp_GetCustomerOrders`）
- 返回多条记录时使用复数名词（如 `usp_GetProducts`）
- 返回单条记录时使用单数名词（如 `usp_GetProduct`）

### 参数处理
- 参数前缀使用 '@'
- 参数名使用 camelCase
- 为可选参数提供默认值
- 使用前验证参数值
- 为参数添加注释文档
- 参数排列保持一致（必需参数在前，可选参数在后）

### 结构规范
- 包含头部注释块说明描述、参数和返回值
- 返回标准化错误代码/消息
- 返回结果集保持一致的列顺序
- 使用 OUTPUT 参数返回状态信息
- 临时表前缀使用 'tmp_'

## 安全最佳实践

- 所有查询参数化以防止 SQL 注入
- 执行动态 SQL 时使用预编译语句
- 避免在 SQL 脚本中嵌入凭证
- 实现适当错误处理，不暴露系统细节
- 避免在存储过程中使用动态 SQL

## 事务管理

- 显式开始和提交事务
- 根据需求使用适当隔离级别
- 避免长时间运行的事务锁定表
- 大数据操作使用批处理
- 修改数据的存储过程中使用 SET NOCOUNT ON
