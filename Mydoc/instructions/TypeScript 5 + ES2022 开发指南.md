# TypeScript 5 + ES2022 开发指南

## 核心技术简介
TypeScript 是 JavaScript 的超集，添加了静态类型检查功能。TypeScript 5.x 针对 ES2022 标准提供了现代化的语言特性和类型系统支持，包括装饰器、顶层 await、RegExp 匹配索引等新特性。

## 核心开发原则

### 代码质量
- 尊重现有架构和编码标准
- 优先选择可读性强、显式的解决方案，避免过于巧妙的写法
- 在现有抽象基础上扩展，避免重复造轮子
- 优先考虑可维护性和清晰度，保持方法和类的简洁性

### 项目组织
- 遵循仓库的文件夹结构和职责划分
- 使用 kebab-case 命名文件（如 `user-session.ts`）
- 将测试、类型定义和辅助工具放在实现附近便于发现
- 优先复用或扩展现有共享工具

## 命名与样式规范

### 命名约定
- 类、接口、枚举和类型别名使用 PascalCase
- 其他所有标识符使用 camelCase
- 避免接口前缀如 `I`，依赖描述性命名
- 根据行为或领域含义命名，而非实现细节

### 代码格式
- 遵循项目缩进、引号风格和尾随逗号规则
- 保持函数专注，逻辑分支复杂时提取辅助函数
- 优先使用不可变数据和纯函数

## 类型系统使用

### 类型安全
- 避免使用 `any`（显式或隐式），优先使用 `unknown` 并进行类型收缩
- 使用可辨识联合类型处理实时事件和状态机
- 集中管理共享契约，避免重复定义类型结构
- 使用 TypeScript 工具类型表达意图（如 `Readonly`、`Partial`、`Record`）

### 现代特性
- 目标 TypeScript 5.x / ES2022，优先使用原生特性而非 polyfill
- 使用纯 ES 模块，不生成 `require`、`module.exports` 或 CommonJS 辅助代码

## 异步处理与错误管理

### 异步编程
- 使用 `async/await` 处理异步操作
- 在 try/catch 中包装 await 调用，使用结构化错误处理
- 提前处理边缘情况，避免深层嵌套

### 错误处理
- 通过项目的日志/遥测工具发送错误信息
- 通过仓库的通知模式向用户展示错误
- 对配置驱动的更新进行防抖处理
- 确定性地释放资源

## 架构与模式

### 模块设计
- 遵循仓库的依赖注入或组合模式
- 保持模块单一职责
- 在接入生命周期时观察现有的初始化和销毁序列
- 保持传输层、领域层和表示层解耦

### 服务实现
- 为服务提供生命周期钩子（如 `initialize`、`dispose`）
- 添加针对性测试

## 外部集成

### 客户端管理
- 在热点路径外实例化客户端，通过注入提高可测试性
- 从安全源加载密钥，不硬编码
- 对网络或 IO 调用应用重试、退避和取消机制
- 标准化外部响应，将错误映射到领域形状

## 安全实践

### 输入验证
- 使用模式验证器或类型守卫验证和清理外部输入
- 避免动态代码执行和不受信任的模板渲染
- 渲染 HTML 前编码不可信内容，使用框架转义或可信类型

### 数据安全
- 使用参数化查询或预编译语句阻止注入攻击
- 将密钥保存在安全存储中，定期轮换，请求最小权限范围
- 对敏感数据使用不可变流程和防御性复制
- 仅使用经过验证的加密库
- 及时修补依赖项并监控安全公告

## 配置与密钥管理

### 配置处理
- 通过共享助手获取配置，使用模式或专用验证器验证
- 通过项目的安全存储处理密钥
- 为新配置键编写文档并更新相关测试

## 性能与可靠性

### 资源管理
- 懒加载重型依赖，使用完毕后释放
- 将耗时操作推迟到用户需要时执行
- 对高频事件进行批处理或防抖以减少抖动
- 跟踪资源生命周期防止内存泄漏

## 测试策略

### 测试覆盖
- 使用项目的框架和命名风格添加或更新单元测试
- 当行为跨越模块或平台 API 时扩展集成或端到端测试套件
- 提交前运行针对性测试脚本获得快速反馈
- 避免脆弱的时间断言，优先使用模拟计时器或注入时钟

## 文档与注释

### 文档编写
- 为公共 API 添加 JSDoc，必要时包含 `@remarks` 或 `@example`
- 编写捕获意图的注释，重构时移除过时注释
- 引入重要模式时更新架构或设计文档
